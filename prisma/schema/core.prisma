model User {
  id                 String              @id @default(uuid())
  email              String              @unique
  name               String
  password           String
  phoneNumber        String
  identyficator      Int?                @unique
  role               Role                @default(TECHNICIAN)
  status             UserStatus          @default(ACTIVE)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  deletedAt          DateTime?
  oplProfile         OplUser?            @relation("UserToOplUser")
  technicianSettings GlobalUserSettings?
  locations          UserLocation[]
  modules            UserModule[]
  vectraProfile      VectraUser?         @relation("UserToVectraUser")

  @@schema("public")
}

model Location {
  id                   String                   @id @default(uuid())
  name                 String                   @unique
  createdAt            DateTime                 @default(now())
  updatedAt            DateTime                 @updatedAt
  oplTransfersFrom     OplLocationTransfer[]    @relation("OplTransfersFromLocation")
  oplTransfersTo       OplLocationTransfer[]    @relation("OplTransfersToLocation")
  oplWarehouseItems    OplWarehouse[]
  oplHistoryFrom       OplWarehouseHistory[]    @relation("OplFromLocationHistory")
  oplHistoryTo         OplWarehouseHistory[]    @relation("OplToLocationHistory")
  users                UserLocation[]
  vectraTransfersFrom  VectraLocationTransfer[] @relation("VectraTransfersFromLocation")
  vectraTransfersTo    VectraLocationTransfer[] @relation("VectraTransfersToLocation")
  vectraWarehouseItems VectraWarehouse[]
  vectraHistoryFrom    VectraWarehouseHistory[] @relation("VectraFromLocationHistory")
  vectraHistoryTo      VectraWarehouseHistory[] @relation("VectraToLocationHistory")

  @@schema("public")
}

model GlobalUserSettings {
  userId          String   @id
  updatedAt       DateTime @updatedAt
  revenueGoal     Float
  workingDaysGoal Int
  user            User     @relation(fields: [userId], references: [id])

  @@schema("public")
}

model Module {
  id      String       @id @default(uuid())
  name    String       @unique
  code    String       @unique
  enabled Boolean      @default(true)
  users   UserModule[]

  @@schema("public")
}

model UserModule {
  id       String @id @default(uuid())
  userId   String
  moduleId String
  module   Module @relation(fields: [moduleId], references: [id])
  user     User   @relation(fields: [userId], references: [id])

  @@unique([userId, moduleId])
  @@schema("public")
}

model UserLocation {
  userId     String
  locationId String
  location   Location @relation(fields: [locationId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, locationId])
  @@schema("public")
}

enum Role {
  TECHNICIAN
  COORDINATOR
  WAREHOUSEMAN
  ADMIN

  @@schema("public")
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  DELETED

  @@schema("public")
}
