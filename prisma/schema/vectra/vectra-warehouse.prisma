model VectraWarehouse {
  id                   String                       @id @default(uuid())
  itemType             VectraWarehouseItemType
  name                 String
  category             VectraDeviceCategory?
  serialNumber         String?                      @unique
  quantity             Int
  unit                 VectraMaterialUnit           @default(PIECE)
  price                Float
  status               VectraWarehouseStatus
  assignedToId         String?
  transferToId         String?
  transferPending      Boolean                      @default(false)
  materialDefinitionId String?
  locationId           String?
  index                String?
  alarmAlert           Int?                         @default(5)
  warningAlert         Int?                         @default(10)
  createdAt            DateTime                     @default(now())
  updatedAt            DateTime                     @updatedAt
  transferLines        VectraLocationTransferLine[] @relation("WarehouseToTransferLines")
  orderAssignments     VectraOrderEquipment[]       @relation("WarehouseToOrderEquipment")
  assignedTo           VectraUser?                  @relation("VectraWarehouseAssignedTo", fields: [assignedToId], references: [userId])
  location             Location?                    @relation(fields: [locationId], references: [id])
  materialDefinition   VectraMaterialDefinition?    @relation("MaterialDefinitionToWarehouse", fields: [materialDefinitionId], references: [id])
  transferTo           VectraUser?                  @relation("VectraWarehouseTransfer", fields: [transferToId], references: [userId])
  history              VectraWarehouseHistory[]

  @@index([itemType])
  @@index([locationId])
  @@index([assignedToId])
  @@schema("vectra")
}

model VectraWarehouseHistory {
  id                 String                  @id @default(uuid())
  warehouseItemId    String
  action             VectraWarehouseAction
  performedById      String
  assignedToId       String?
  assignedOrderId    String?
  fromLocationId     String?
  toLocationId       String?
  locationTransferId String?
  quantity           Int?
  notes              String?
  actionDate         DateTime                @default(now())
  assignedOrder      VectraOrder?            @relation("OrderToWarehouseHistory", fields: [assignedOrderId], references: [id])
  assignedTo         VectraUser?             @relation("VectraWHAssignedTo", fields: [assignedToId], references: [userId])
  fromLocation       Location?               @relation("VectraFromLocationHistory", fields: [fromLocationId], references: [id])
  locationTransfer   VectraLocationTransfer? @relation("LocationTransferToHistory", fields: [locationTransferId], references: [id])
  performedBy        VectraUser              @relation("VectraWHPerformedBy", fields: [performedById], references: [userId])
  toLocation         Location?               @relation("VectraToLocationHistory", fields: [toLocationId], references: [id])
  warehouseItem      VectraWarehouse         @relation(fields: [warehouseItemId], references: [id])

  @@index([warehouseItemId])
  @@index([action])
  @@index([actionDate])
  @@schema("vectra")
}

model VectraLocationTransfer {
  id             String                       @id @default(uuid())
  fromLocationId String
  toLocationId   String
  status         VectraLocationTransferStatus @default(REQUESTED)
  requestedById  String
  confirmedById  String?
  confirmedAt    DateTime?
  notes          String?
  createdAt      DateTime                     @default(now())
  confirmedBy    VectraUser?                  @relation("VectraConfirmedTransfers", fields: [confirmedById], references: [userId])
  fromLocation   Location                     @relation("VectraTransfersFromLocation", fields: [fromLocationId], references: [id])
  requestedBy    VectraUser                   @relation("VectraRequestedTransfers", fields: [requestedById], references: [userId])
  toLocation     Location                     @relation("VectraTransfersToLocation", fields: [toLocationId], references: [id])
  lines          VectraLocationTransferLine[]
  histories      VectraWarehouseHistory[]     @relation("LocationTransferToHistory")

  @@index([fromLocationId])
  @@index([toLocationId])
  @@index([status])
  @@schema("vectra")
}

model VectraLocationTransferLine {
  id                   String                    @id @default(uuid())
  transferId           String
  itemType             VectraWarehouseItemType
  warehouseItemId      String?
  materialDefinitionId String?
  quantity             Int?
  unit                 VectraMaterialUnit?
  nameSnapshot         String?
  indexSnapshot        String?
  category             VectraDeviceCategory?
  materialDefinition   VectraMaterialDefinition? @relation("MaterialDefinitionToTransferLines", fields: [materialDefinitionId], references: [id])
  transfer             VectraLocationTransfer    @relation(fields: [transferId], references: [id])
  warehouseItem        VectraWarehouse?          @relation("WarehouseToTransferLines", fields: [warehouseItemId], references: [id])

  @@index([transferId])
  @@index([warehouseItemId])
  @@schema("vectra")
}

model VectraMaterialDefinition {
  id               String                            @id @default(uuid())
  name             String                            @unique
  index            String?
  unit             VectraMaterialUnit                @default(PIECE)
  price            Float?                            @default(0)
  alarmAlert       Int?                              @default(5)
  warningAlert     Int?                              @default(10)
  transferLines    VectraLocationTransferLine[]      @relation("MaterialDefinitionToTransferLines")
  orderMaterials   VectraOrderMaterial[]             @relation("MaterialToOrderMaterial")
  materialDeficits VectraTechnicianMaterialDeficit[]
  warehouseItems   VectraWarehouse[]                 @relation("MaterialDefinitionToWarehouse")

  @@schema("vectra")
}

model VectraDeviceDefinition {
  id           String               @id @default(uuid())
  category     VectraDeviceCategory
  name         String
  price        Float?               @default(0)
  alarmAlert   Int?                 @default(5)
  warningAlert Int?                 @default(10)

  @@schema("vectra")
}

model VectraTechnicianMaterialDeficit {
  id                   String                   @id @default(uuid())
  technicianId         String
  materialDefinitionId String
  quantity             Int
  createdAt            DateTime                 @default(now())
  updatedAt            DateTime                 @updatedAt
  materialDefinition   VectraMaterialDefinition @relation(fields: [materialDefinitionId], references: [id])
  technician           VectraUser               @relation("VectraMaterialDeficitTechnician", fields: [technicianId], references: [userId])

  @@unique([technicianId, materialDefinitionId])
  @@schema("vectra")
}
