//prisma/schema/vectra/vectra-core.prisma

/// -----------------------------------------
/// VECTRA CORE (schema: vectra)
/// -----------------------------------------

model VectraUser {
  @@schema("vectra")
  userId    String   @id
  active         Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deactivatedAt  DateTime?

  // Bridge to global User
  user User @relation("UserToVectraUser", fields: [userId], references: [id])

  technicianSettings VectraTechnicianSettings?

  // --- Relations used throughout the module ---
  ordersAssigned    VectraOrder[]        @relation("VectraOrderAssignedTo")
  ordersTransferred VectraOrder[]        @relation("VectraOrderTransfer")
  orderHistory      VectraOrderHistory[] @relation("VectraOrderHistoryByUser")

  warehouseItems   VectraWarehouse[] @relation("VectraWarehouseAssignedTo")
  transferredItems VectraWarehouse[] @relation("VectraWarehouseTransfer")

  warehouseHistoryAssigned  VectraWarehouseHistory[] @relation("VectraWHAssignedTo")
  warehouseHistoryPerformed VectraWarehouseHistory[] @relation("VectraWHPerformedBy")

  transfersRequested VectraLocationTransfer[] @relation("VectraRequestedTransfers")
  transfersConfirmed VectraLocationTransfer[] @relation("VectraConfirmedTransfers")

  materialDeficits VectraTechnicianMaterialDeficit[] @relation("VectraMaterialDeficitTechnician")
}

model VectraTechnicianSettings {
  @@schema("vectra")
  userId          String   @id
  workingDaysGoal Int
  revenueGoal     Float
  updatedAt       DateTime @updatedAt

  vectraUser VectraUser @relation(fields: [userId], references: [userId])
}

model VectraRateDefinition {
  @@schema("vectra")
  id     String @id @default(uuid())
  code   String @unique
  amount Float

  settlements VectraOrderSettlementEntry[] @relation("RateDefinitionToSettlement")
}

model VectraOperatorDefinition {
  @@schema("vectra")
  operator String @unique
}
