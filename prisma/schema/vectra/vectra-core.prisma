//prisma/schema/vectra/vectra-core.prisma

/// -----------------------------------------
/// VECTRA CORE (schema: vectra)
/// -----------------------------------------

model VectraUser {
  userId String  @id
  active Boolean @default(true)

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  deactivatedAt DateTime?

  // Bridge to global User
  user User @relation("UserToVectraUser", fields: [userId], references: [id])

  // --- Relations used throughout the module ---
  ordersAssigned    VectraOrder[]        @relation("VectraOrderAssignedTo")
  ordersTransferred VectraOrder[]        @relation("VectraOrderTransfer")
  orderHistory      VectraOrderHistory[] @relation("VectraOrderHistoryByUser")

  warehouseItems   VectraWarehouse[] @relation("VectraWarehouseAssignedTo")
  transferredItems VectraWarehouse[] @relation("VectraWarehouseTransfer")

  warehouseHistoryAssigned  VectraWarehouseHistory[] @relation("VectraWHAssignedTo")
  warehouseHistoryPerformed VectraWarehouseHistory[] @relation("VectraWHPerformedBy")

  transfersRequested VectraLocationTransfer[] @relation("VectraRequestedTransfers")
  transfersConfirmed VectraLocationTransfer[] @relation("VectraConfirmedTransfers")

  materialDeficits               VectraTechnicianMaterialDeficit[] @relation("VectraMaterialDeficitTechnician")
  VectraTechnicianSettingsLegacy VectraTechnicianSettingsLegacy[]

  @@schema("vectra")
}

model VectraRateDefinition {
  id     String @id @default(uuid())
  code   String @unique
  amount Float

  settlements VectraOrderSettlementEntry[] @relation("RateDefinitionToSettlement")

  @@schema("vectra")
}

model VectraOperatorDefinition {
  operator String @unique

  @@schema("vectra")
}

model VectraTechnicianSettingsLegacy {

  userId          String   @id
  workingDaysGoal Int
  revenueGoal     Float
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  user VectraUser @relation(fields: [userId], references: [userId])

  @@map("VectraTechnicianSettings")
  @@schema("vectra")
}

model VectraWarehouseLocationLegacy {

  id        String   @id
  name      String
  createdAt DateTime
  updatedAt DateTime

  @@map("VectraWarehouseLocation")
  @@schema("vectra")
}
